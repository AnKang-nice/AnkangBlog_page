import{_ as i,c as a,a4 as n,o as h}from"./chunks/framework.vOILIgLK.js";const d=JSON.parse('{"title":"pre-commit 拓展脚本","description":"","frontmatter":{},"headers":[],"relativePath":"TutorialRecord/项目/项目规范流搭建/5.pre-commit 拓展脚本.md","filePath":"TutorialRecord/项目/项目规范流搭建/5.pre-commit 拓展脚本.md"}'),l={name:"TutorialRecord/项目/项目规范流搭建/5.pre-commit 拓展脚本.md"};function t(p,s,k,e,E,r){return h(),a("div",null,s[0]||(s[0]=[n(`<h1 id="pre-commit-拓展脚本" tabindex="-1">pre-commit 拓展脚本 <a class="header-anchor" href="#pre-commit-拓展脚本" aria-label="Permalink to &quot;pre-commit 拓展脚本&quot;">​</a></h1><h2 id="目的" tabindex="-1">目的 <a class="header-anchor" href="#目的" aria-label="Permalink to &quot;目的&quot;">​</a></h2><p>当我们项目中某些文件（公共配置文件、需要小心修改的文件）发生变动的时候，我们要拦截，并在 commit 的时候，给予用户提示，让用户输入 y / n 确定是否要继续提交</p><h2 id="实现" tabindex="-1">实现 <a class="header-anchor" href="#实现" aria-label="Permalink to &quot;实现&quot;">​</a></h2><p>在 pre-commit 钩子中添加脚本</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 定义颜色代码</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">RED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\033</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[0;31m&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">GREEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\033</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[0;32m&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">YELLOW</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\033</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[0;33m&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CYAN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\033</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[0;36m&#39;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\033</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[0m&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> # No Color</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 定义需要检测的文件列表，用空格分隔</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FILES_TO_CHECK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;.eslintrc.cjs&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.prettierrc.json&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;.stylelintrc.cjs&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;commitlint.config.js&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &quot;.vscode/settings.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 获取暂存区中被修改的文件列表</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">MODIFIED_FILES</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(git diff </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cached </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">only)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 标志变量，表示是否有目标文件被修改</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IS_MODIFIED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 检查每个文件是否被修改</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">for </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">FILE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;\${FILES_TO_CHECK[@]}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$MODIFIED_FILES&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> grep </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">q </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$FILE&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        echo  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${YELLOW}⚠️ 检测到\${CYAN} $FILE \${YELLOW}配置文件已被修改！，请与团队成员确认后确定是否提交。\${NC}&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        IS_MODIFIED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fi</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">done</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"># 如果有目标文件被修改，提示用户确认是否继续提交</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $IS_MODIFIED; then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    read </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">p </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;是否继续提交? (y/n): &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CONFIRM</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dev</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tty</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [[ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$CONFIRM&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =~</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ^</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[Yy]$ ]]; then</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        echo  </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${GREEN}✅ 用户确认，继续提交。\${NC}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        exit </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${RED}❌ 用户取消提交。\${NC}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        exit </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fi</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    # 如果未修改目标文件，正常退出</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    echo </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\${GREEN}✅ 目标文件未修改，继续提交。\${NC}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exit </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fi</span></span></code></pre></div><h2 id="效果" tabindex="-1">效果 <img src="https://ankang-blog-img.oss-cn-beijing.aliyuncs.com/myBlogImg/20250409/2frQ6c.png" alt="" data-fancybox="gallery" loading="lazy"> <a class="header-anchor" href="#效果" aria-label="Permalink to &quot;效果 ![](https://ankang-blog-img.oss-cn-beijing.aliyuncs.com/myBlogImg/20250409/2frQ6c.png)&quot;">​</a></h2>`,7)]))}const g=i(l,[["render",t]]);export{d as __pageData,g as default};
